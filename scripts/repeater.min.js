jQuery.fn.repeater=function(s){this.options=jQuery.extend(!0,{},{template:"",limit:5,items:[{}],saveEvents:"blur change",saveElements:"input, select",addImageSrc:"",removeImageSrc:"",callbacks:{save:function(){},beforeAdd:function(){},add:function(){},beforeAddNew:function(){},addNew:function(){},beforeRemove:function(){},remove:function(){},repeaterButtons:function(){return!1}}},s),this.elem=jQuery(this),this.items=this.options.items,this.callbacks=this.options.callbacks,this._template=this.options.template?this.options.template:this.elem.next("#"+this.elem.prop("id")+"-template").html();var e=this.options.saveEvents.split(" "),t=[];for(i in e)t.push(e[i]+".repeater");return this.options.saveEvents=t.join(" "),this.init=function(){for(i in this._template||(this._template=this.elem.html()),this.elem.after('<div id="'+this.elem.prop("id")+'-template" style="display:none">'+this._template+"</div>"),this.elem.addClass("repeater"),this.elem.empty(),this.items)this.addItem(this.items[i],i);var t=this;return jQuery(this.elem).off("click.repeater",'a.add-item:not(".inactive")'),jQuery(this.elem).on("click.repeater",'a.add-item:not(".inactive")',function(e){t.addNewItem(this)}),jQuery(this.elem).off("click.repeater","a.remove-item"),jQuery(this.elem).on("click.repeater","a.remove-item",function(e){t.removeItem(this)}),jQuery(this.elem).off(this.options.saveEvents,this.options.saveElements),jQuery(this.elem).on(this.options.saveEvents,this.options.saveElements,function(){t.save()}),this},this.addItem=function(e,t){var i=this._template;for(var s in e){i=i.replace(/{i}/g,t);var a=this.callbacks.repeaterButtons(this,t)?this.callbacks.repeaterButtons(this,t):this.addRepeaterButtons(t);i=i.replace("{buttons}",a);var r=new RegExp("{"+s+"}","g");i=i.replace(r,e[s])}var n=jQuery(i).addClass("item-"+t);this.callbacks.beforeAdd(this,n,e),this.append(n),this.callbacks.add(this,n,e)},this.addRepeaterButtons=function(e){var t='<div class="repeater-buttons">';return t+='<a class="add-item '+(this.items.length>=s.limit&&0!==s.limit?"inactive":"")+'" data-index="'+e+'">',t+='<img src="'+s.addImageSrc+'/images/add.png" alt="Add" /></a>',1<this.items.length&&(t+='<a class="remove-item" data-index="'+e+'"><img src="'+s.removeImageSrc+'/images/remove.png" alt="Remove" /></a>'),t},this.addNewItem=function(e){var t=jQuery(e).attr("data-index");this.callbacks.beforeAddNew(this,t),this.items.splice(t+1,0,this.getBaseObject()),this.callbacks.addNew(this,t),this.refresh()},this.removeItem=function(e){var t=jQuery(e).attr("data-index");this.callbacks.beforeRemove(this,t),delete this.items[t],this.callbacks.remove(this,t),this.save(),this.refresh()},this.refresh=function(){for(i in this.elem.empty(),this.items)this.addItem(this.items[i],i)},this.save=function(){var e=this.getDataKeys(),t=new Array;for(i=0;i<this.items.length;i++)if(void 0!==this.items[i]){var s={};for(j in e){var a=e[j],r="#"+a+"_"+i;s[a]=jQuery(this.elem).find(r).val()}t.push(s)}this.items=t,this.callbacks.save(this,t)},this.getDataKeys=function(){var e=new Array;for(var t in this.items)if(void 0!==this.items[t]){for(var i in this.items[t])e[e.length]=i;break}return e},this.getBaseObject=function(){var e={},t=this.getDataKeys();for(var i in t)e[t[i]]="";return e},this.init(!0)};
//# sourceMappingURL=repeater.js.map